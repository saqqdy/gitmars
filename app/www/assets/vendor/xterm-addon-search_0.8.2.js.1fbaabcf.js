var W={exports:{}};(function(S,z){(function(b,C){S.exports=C()})(self,function(){return(()=>{var b={};return(()=>{var C=b;Object.defineProperty(C,"__esModule",{value:!0}),C.SearchAddon=void 0;var I=" ~!@#$%^&*()+`-=[]{}|\\;:\"',./<>?",y=function(){function f(){this._linesCacheTimeoutId=0}return f.prototype.activate=function(e){this._terminal=e},f.prototype.dispose=function(){},f.prototype.findNext=function(e,t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!e||e.length===0)return this._terminal.clearSelection(),!1;var i,n=0,a=0;if(this._terminal.hasSelection()){var s=!!t&&t.incremental;i=this._terminal.getSelectionPosition(),a=s?i.startRow:i.endRow,n=s?i.startColumn:i.endColumn}this._initLinesCache();var r={startRow:a,startCol:n},l=this._findInLine(e,r,t);if(!l)for(var o=a+1;o<this._terminal.buffer.active.baseY+this._terminal.rows&&(r.startRow=o,r.startCol=0,!(l=this._findInLine(e,r,t)));o++);if(!l&&a!==0)for(o=0;o<a&&(r.startRow=o,r.startCol=0,!(l=this._findInLine(e,r,t)));o++);return!l&&i&&(r.startRow=i.startRow,r.startCol=0,l=this._findInLine(e,r,t)),this._selectResult(l)},f.prototype.findPrevious=function(e,t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!e||e.length===0)return this._terminal.clearSelection(),!1;var i,n,a=!0,s=this._terminal.buffer.active.baseY+this._terminal.rows,r=this._terminal.cols,l=!!t&&t.incremental;this._terminal.hasSelection()&&(s=(n=this._terminal.getSelectionPosition()).startRow,r=n.startColumn),this._initLinesCache();var o={startRow:s,startCol:r};if(l?(i=this._findInLine(e,o,t,!1))&&i.row===s&&i.col===r||(n&&(o.startRow=n.endRow,o.startCol=n.endColumn),i=this._findInLine(e,o,t,!0)):i=this._findInLine(e,o,t,a),!i){o.startCol=Math.max(o.startCol,this._terminal.cols);for(var h=s-1;h>=0&&(o.startRow=h,!(i=this._findInLine(e,o,t,a)));h--);}if(!i&&s!==this._terminal.buffer.active.baseY+this._terminal.rows)for(h=this._terminal.buffer.active.baseY+this._terminal.rows;h>=s&&(o.startRow=h,!(i=this._findInLine(e,o,t,a)));h--);return!(i||!n)||this._selectResult(i)},f.prototype._initLinesCache=function(){var e=this,t=this._terminal;this._linesCache||(this._linesCache=new Array(t.buffer.active.length),this._cursorMoveListener=t.onCursorMove(function(){return e._destroyLinesCache()}),this._resizeListener=t.onResize(function(){return e._destroyLinesCache()})),window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=window.setTimeout(function(){return e._destroyLinesCache()},15e3)},f.prototype._destroyLinesCache=function(){this._linesCache=void 0,this._cursorMoveListener&&(this._cursorMoveListener.dispose(),this._cursorMoveListener=void 0),this._resizeListener&&(this._resizeListener.dispose(),this._resizeListener=void 0),this._linesCacheTimeoutId&&(window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=0)},f.prototype._isWholeWord=function(e,t,i){return(e===0||I.includes(t[e-1]))&&(e+i.length===t.length||I.includes(t[e+i.length]))},f.prototype._findInLine=function(e,t,i,n){var a;i===void 0&&(i={}),n===void 0&&(n=!1);var s=this._terminal,r=t.startRow,l=t.startCol,o=s.buffer.active.getLine(r);if(o==null?void 0:o.isWrapped)return n?void(t.startCol+=s.cols):(t.startRow--,t.startCol+=s.cols,this._findInLine(e,t,i));var h=(a=this._linesCache)===null||a===void 0?void 0:a[r];h||(h=this._translateBufferLineToStringWithWrap(r,!0),this._linesCache&&(this._linesCache[r]=h));var _=h[0],v=h[1],g=this._bufferColsToStringOffset(r,l),p=i.caseSensitive?e:e.toLowerCase(),L=i.caseSensitive?_:_.toLowerCase(),c=-1;if(i.regex){var m=RegExp(p,"g"),d=void 0;if(n)for(;d=m.exec(L.slice(0,g));)c=m.lastIndex-d[0].length,e=d[0],m.lastIndex-=e.length-1;else(d=m.exec(L.slice(g)))&&d[0].length>0&&(c=g+(m.lastIndex-d[0].length),e=d[0])}else n?g-p.length>=0&&(c=L.lastIndexOf(p,g-p.length)):c=L.indexOf(p,g);if(c>=0){if(i.wholeWord&&!this._isWholeWord(c,L,e))return;for(var u=0;u<v.length-1&&c>=v[u+1];)u++;for(var w=u;w<v.length-1&&c+e.length>=v[w+1];)w++;var x=c-v[u],T=c+e.length-v[w],R=this._stringLengthToBufferSize(r+u,x);return{term:e,col:R,row:r+u,size:this._stringLengthToBufferSize(r+w,T)-R+s.cols*(w-u)}}},f.prototype._stringLengthToBufferSize=function(e,t){var i=this._terminal.buffer.active.getLine(e);if(!i)return 0;for(var n=0;n<t;n++){var a=i.getCell(n);if(!a)break;var s=a.getChars();s.length>1&&(t-=s.length-1);var r=i.getCell(n+1);r&&r.getWidth()===0&&t++}return t},f.prototype._bufferColsToStringOffset=function(e,t){for(var i=this._terminal,n=e,a=0,s=i.buffer.active.getLine(n);t>0&&s;){for(var r=0;r<t&&r<i.cols;r++){var l=s.getCell(r);if(!l)break;l.getWidth()&&(a+=l.getChars().length)}if(n++,(s=i.buffer.active.getLine(n))&&!s.isWrapped)break;t-=i.cols}return a},f.prototype._translateBufferLineToStringWithWrap=function(e,t){for(var i,n=this._terminal,a=[],s=[0],r=n.buffer.active.getLine(e);r;){var l=n.buffer.active.getLine(e+1),o=!!l&&l.isWrapped,h=r.translateToString(!o&&t);if(o&&l){var _=r.getCell(r.length-1);_&&_.getCode()===0&&_.getWidth()===1&&((i=l.getCell(0))===null||i===void 0?void 0:i.getWidth())===2&&(h=h.slice(0,-1))}if(a.push(h),!o)break;s.push(s[s.length-1]+h.length),e++,r=l}return[a.join(""),s]},f.prototype._selectResult=function(e){var t=this._terminal;if(!e)return t.clearSelection(),!1;if(t.select(e.col,e.row,e.size),e.row>=t.buffer.active.viewportY+t.rows||e.row<t.buffer.active.viewportY){var i=e.row-t.buffer.active.viewportY;i-=Math.floor(t.rows/2),t.scrollLines(i)}return!0},f}();C.SearchAddon=y})(),b})()})})(W);export{W as x};
