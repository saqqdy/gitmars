System.register([],(function(e){"use strict";return{execute:function(){var t,i=e("x",{exports:{}});self,i.exports=(t={},function(){var e=t;Object.defineProperty(e,"__esModule",{value:!0}),e.SearchAddon=void 0;var i=" ~!@#$%^&*()+`-=[]{}|\\;:\"',./<>?",r=function(){function e(){this._linesCacheTimeoutId=0}return e.prototype.activate=function(e){this._terminal=e},e.prototype.dispose=function(){},e.prototype.findNext=function(e,t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!e||0===e.length)return this._terminal.clearSelection(),!1;var i,r=0,n=0;if(this._terminal.hasSelection()){var s=!!t&&t.incremental;i=this._terminal.getSelectionPosition(),n=s?i.startRow:i.endRow,r=s?i.startColumn:i.endColumn}this._initLinesCache();var o={startRow:n,startCol:r},a=this._findInLine(e,o,t);if(!a)for(var l=n+1;l<this._terminal.buffer.active.baseY+this._terminal.rows&&(o.startRow=l,o.startCol=0,!(a=this._findInLine(e,o,t)));l++);if(!a&&0!==n)for(l=0;l<n&&(o.startRow=l,o.startCol=0,!(a=this._findInLine(e,o,t)));l++);return!a&&i&&(o.startRow=i.startRow,o.startCol=0,a=this._findInLine(e,o,t)),this._selectResult(a)},e.prototype.findPrevious=function(e,t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!e||0===e.length)return this._terminal.clearSelection(),!1;var i,r,n=!0,s=this._terminal.buffer.active.baseY+this._terminal.rows,o=this._terminal.cols,a=!!t&&t.incremental;this._terminal.hasSelection()&&(s=(r=this._terminal.getSelectionPosition()).startRow,o=r.startColumn),this._initLinesCache();var l={startRow:s,startCol:o};if(a?(i=this._findInLine(e,l,t,!1))&&i.row===s&&i.col===o||(r&&(l.startRow=r.endRow,l.startCol=r.endColumn),i=this._findInLine(e,l,t,!0)):i=this._findInLine(e,l,t,n),!i){l.startCol=Math.max(l.startCol,this._terminal.cols);for(var h=s-1;h>=0&&(l.startRow=h,!(i=this._findInLine(e,l,t,n)));h--);}if(!i&&s!==this._terminal.buffer.active.baseY+this._terminal.rows)for(h=this._terminal.buffer.active.baseY+this._terminal.rows;h>=s&&(l.startRow=h,!(i=this._findInLine(e,l,t,n)));h--);return!(i||!r)||this._selectResult(i)},e.prototype._initLinesCache=function(){var e=this,t=this._terminal;this._linesCache||(this._linesCache=new Array(t.buffer.active.length),this._cursorMoveListener=t.onCursorMove((function(){return e._destroyLinesCache()})),this._resizeListener=t.onResize((function(){return e._destroyLinesCache()}))),window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=window.setTimeout((function(){return e._destroyLinesCache()}),15e3)},e.prototype._destroyLinesCache=function(){this._linesCache=void 0,this._cursorMoveListener&&(this._cursorMoveListener.dispose(),this._cursorMoveListener=void 0),this._resizeListener&&(this._resizeListener.dispose(),this._resizeListener=void 0),this._linesCacheTimeoutId&&(window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=0)},e.prototype._isWholeWord=function(e,t,r){return(0===e||i.includes(t[e-1]))&&(e+r.length===t.length||i.includes(t[e+r.length]))},e.prototype._findInLine=function(e,t,i,r){var n;void 0===i&&(i={}),void 0===r&&(r=!1);var s=this._terminal,o=t.startRow,a=t.startCol,l=s.buffer.active.getLine(o);if(null==l?void 0:l.isWrapped)return r?void(t.startCol+=s.cols):(t.startRow--,t.startCol+=s.cols,this._findInLine(e,t,i));var h=null===(n=this._linesCache)||void 0===n?void 0:n[o];h||(h=this._translateBufferLineToStringWithWrap(o,!0),this._linesCache&&(this._linesCache[o]=h));var f=h[0],c=h[1],u=this._bufferColsToStringOffset(o,a),d=i.caseSensitive?e:e.toLowerCase(),_=i.caseSensitive?f:f.toLowerCase(),v=-1;if(i.regex){var g=RegExp(d,"g"),C=void 0;if(r)for(;C=g.exec(_.slice(0,u));)v=g.lastIndex-C[0].length,e=C[0],g.lastIndex-=e.length-1;else(C=g.exec(_.slice(u)))&&C[0].length>0&&(v=u+(g.lastIndex-C[0].length),e=C[0])}else r?u-d.length>=0&&(v=_.lastIndexOf(d,u-d.length)):v=_.indexOf(d,u);if(v>=0){if(i.wholeWord&&!this._isWholeWord(v,_,e))return;for(var p=0;p<c.length-1&&v>=c[p+1];)p++;for(var w=p;w<c.length-1&&v+e.length>=c[w+1];)w++;var m=v-c[p],L=v+e.length-c[w],b=this._stringLengthToBufferSize(o+p,m);return{term:e,col:b,row:o+p,size:this._stringLengthToBufferSize(o+w,L)-b+s.cols*(w-p)}}},e.prototype._stringLengthToBufferSize=function(e,t){var i=this._terminal.buffer.active.getLine(e);if(!i)return 0;for(var r=0;r<t;r++){var n=i.getCell(r);if(!n)break;var s=n.getChars();s.length>1&&(t-=s.length-1);var o=i.getCell(r+1);o&&0===o.getWidth()&&t++}return t},e.prototype._bufferColsToStringOffset=function(e,t){for(var i=this._terminal,r=e,n=0,s=i.buffer.active.getLine(r);t>0&&s;){for(var o=0;o<t&&o<i.cols;o++){var a=s.getCell(o);if(!a)break;a.getWidth()&&(n+=a.getChars().length)}if(r++,(s=i.buffer.active.getLine(r))&&!s.isWrapped)break;t-=i.cols}return n},e.prototype._translateBufferLineToStringWithWrap=function(e,t){for(var i,r=this._terminal,n=[],s=[0],o=r.buffer.active.getLine(e);o;){var a=r.buffer.active.getLine(e+1),l=!!a&&a.isWrapped,h=o.translateToString(!l&&t);if(l&&a){var f=o.getCell(o.length-1);f&&0===f.getCode()&&1===f.getWidth()&&2===(null===(i=a.getCell(0))||void 0===i?void 0:i.getWidth())&&(h=h.slice(0,-1))}if(n.push(h),!l)break;s.push(s[s.length-1]+h.length),e++,o=a}return[n.join(""),s]},e.prototype._selectResult=function(e){var t=this._terminal;if(!e)return t.clearSelection(),!1;if(t.select(e.col,e.row,e.size),e.row>=t.buffer.active.viewportY+t.rows||e.row<t.buffer.active.viewportY){var i=e.row-t.buffer.active.viewportY;i-=Math.floor(t.rows/2),t.scrollLines(i)}return!0},e}();e.SearchAddon=r}(),t)}}}));
