var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,o=(a,l,n)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[l]=n,r=(e,a)=>{for(var l in a||(a={}))t.call(a,l)&&o(e,l,a[l]);if(n)for(var l of n(a))u.call(a,l)&&o(e,l,a[l]);return e},c=(e,n)=>a(e,l(n));import{M as d,r as m,ai as i,A as s,g as p,o as V,j as h,i as v,F as f,ad as b,q as y,t as x,h as g,w as k,u as j,c as C,d as E,e as w,L as U,a5 as _,H as O,aa as $,ab as q,B as I,aj as L,ag as S,k as P,v as A,x as N,p as z}from"./vendor.e07efed3.js";import{X as B}from"./index.8552f0d4.js";import{_ as M,T as D,S as G}from"./index.e365cd8a.js";import{u as X}from"./use-current-instance.c580ffd2.js";const H={class:"command-wrap"},T={class:"r"},F={class:"r"};const W=d(c(r({},{name:"Command",inheritAttrs:!1}),{props:{modelValue:{type:Object,default:()=>({options:[],args:[]}),required:!0},current:String},emits:["update:modelValue"],setup:function(e,{expose:a,emit:l}){const n=m(i(e.modelValue));return n.options.forEach((e=>{"value"in e||(e.value=null)})),n.args.forEach((e=>{"value"in e||(e.value=null)})),s(n,(e=>{l("update:modelValue",e)}),{deep:!0}),a({data:n}),(e,a)=>{const l=p("el-option"),t=p("el-select"),u=p("el-input"),o=p("el-checkbox");return V(),h("div",H,[v("ul",null,[(V(!0),h(f,null,b(j(n).args,(e=>(V(),h("li",{key:e.name},[y(x(e.name)+" ",1),v("div",T,[e.options?(V(),g(t,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,key:e.name+"-arg",placeholder:e.required?"必填":"选填",clearable:""},{default:k((()=>[(V(!0),h(f,null,b(e.options,(e=>(V(),g(l,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):(V(),g(u,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,key:e.name+"-arg",placeholder:e.required?"必填":"选填",clearable:""},null,8,["modelValue","onUpdate:modelValue","placeholder"]))])])))),128))]),v("ul",null,[(V(!0),h(f,null,b(j(n).options,(e=>(V(),h("li",{key:e.long},[y(x(e.description)+" ",1),v("div",F,[e.optional?(V(),h(f,{key:0},[e.options?(V(),g(t,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,key:e.long+"-arg",placeholder:e.required?"必填":"选填",clearable:""},{default:k((()=>[(V(!0),h(f,null,b(e.options,(e=>(V(),g(l,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):(V(),g(u,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,key:e.long+"-option",placeholder:e.required?"必填":"选填",clearable:""},null,8,["modelValue","onUpdate:modelValue","placeholder"]))],64)):(V(),g(o,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,key:e.long+"-option-check"},null,8,["modelValue","onUpdate:modelValue"]))])])))),128))])])}}}));const J={class:"map-command-wrap"},K=y("执行");const Q=d(c(r({},{name:"MapCommand",inheritAttrs:!1}),{props:{data:{type:Object,default:()=>({options:[],args:[]}),required:!1},value:{type:Object,default:()=>({options:[],args:[]}),required:!0},current:{type:String,default:"",required:!0}},emits:["exec"],setup:function(e,{expose:a,emit:l}){const n=e,t=C(""),{command:u,short:o}=i(n.value),r=E((()=>{let e=i(n.current).split("/");return["bugfix","feature","support"].includes(e[0])?{type:e[0],name:e[1]}:null})),c=()=>{l("exec",t.value)};return s((()=>n.value),(e=>{t.value=(({options:e,args:a})=>{let l=[],n=[],t=[];for(let u of e)if(null!==u.value){let e=u.short||u.long,a=u.value instanceof Array?u.value.join(" "):u.value;if(u.optional||!u.short){if(!a)continue;u.optional?(a=' "'+a+'"',u.defaultValue&&(a=' "'+u.defaultValue+'"'),n.push(e+a)):n.push(e)}else u.short&&(t.length>0&&(e=e.substr(1)),a&&t.push(e))}for(let u of a)u.value&&l.push(u.value);return`gitm ${u} ${l.join(" ")} ${t.join("")} ${n.join(" ")}`.replace(/[\s]{2,}/g," ")})(e)}),{deep:!0,immediate:!0}),a({curBranch:r,cmd:t,exec:c}),(e,a)=>{const l=p("v3-button");return V(),h("div",J,[v("span",null,x(t.value),1),w(l,{type:"primary",size:"small",onClick:U(c,["stop"]),plain:""},{default:k((()=>[K])),_:1},8,["onClick"])])}}})),R={};let Y={};for(let _e in R){let e=_e.replace(/^.+\/(\w+)\.js$/,"$1");if(!Object.keys(R[_e]).length){Y=window.gitmarsCmdConfig;break}Y[e]=R[_e]}var Z=Y;const ee={class:"box"},ae=y("/ ");const le=d(c(r({},{inheritAttrs:!1}),{setup:function(e,{expose:a}){const l=m({type:"",name:""});return a({data:l,submit:()=>new Promise(((e,a)=>{l.type&&l.name?e(i(l)):a()}))}),(e,a)=>(V(),h("div",ee,[w(j(_),{modelValue:j(l).type,"onUpdate:modelValue":a[0]||(a[0]=e=>j(l).type=e),placeholder:"分支类型"},null,8,["modelValue"]),ae,w(j(_),{modelValue:j(l).name,"onUpdate:modelValue":a[1]||(a[1]=e=>j(l).name=e),placeholder:"分支名称"},null,8,["modelValue"])]))}}));const ne=d({name:"ControlGitmars",components:{Xterm:B,Command:W,MapCommand:Q},async setup(){const{getTerminal:e,fitAddon:a}=O(D,{}),{socket:l,socketGitmars:n}=O(G,{}),{globalProperties:{$axios:t,$box:u}}=X();$();const o=q(),r=window.innerWidth,c=window.innerHeight,d=m({project:{id:"",name:"",path:""},terminal:{name:""},activeNames:"",branchs:[],current:"",ready:!1,error:{}}),i=E((()=>"gitmars-"+d.project.id)),s=m(Z),p=E((()=>{let e={bugfix:[],feature:[],others:[]};return d.branchs.forEach((a=>{a.indexOf("bugfix/")>-1?e.bugfix.push(a):a.indexOf("feature/")>-1?e.feature.push(a):e.others.push(a)})),e}));I((()=>{n.emit("create",{name:d.project.id,cwd:d.project.path}),n.on(d.project.id+"-branch",(e=>{d&&(d.branchs=e)})),n.on(d.project.id+"-current",(e=>{d&&(d.current=e)}))})),L((()=>{n.emit("remove",d.project.id)})),S((e=>(d.error=e,!0)));const V=async()=>(await t({url:"/common/project/list",data:{id:o.query.id}})).data,h=e=>{d.terminal&&l.emit(d.terminal.name+"-input",` ${e}\r`)};d.project=await V(),await t({url:"/cmd/cd",data:{dir:d.project.path}}),d.branchs=await(async()=>(await t({url:"/cmd/branch/list",data:{}})).data)(),d.current=await(async()=>(await t({url:"/cmd/branch/current",data:{}})).data)(),d.terminal=e&&e(i.value,d.project.path,parseInt(String((r-60-300-32)/7.05)),parseInt(String((c-64-32-34-400)/17.6))),d.ready=!0;return{data:d,terminalID:i,exec:h,commandValue:s,route:o,branchList:p,handleItemClick:()=>{console.log("handleItemClick",666)},handleChange:()=>{console.log("handleChange",444)},createBranch:()=>{u(le,{width:"640px",height:"240px",title:"创建分支",options:{},onOk:async e=>{let{type:a,name:l}=await e.component.proxy.submit();return h(`gitm start ${a} ${l}`),!0}})},saveStash:()=>{},checkout:async e=>{h(`git checkout ${e}`),d.project=await V()}}}}),te=e=>(A("data-v-22b59854"),e=e(),N(),e),ue={key:0,class:"page"},oe=y(" Gitmars工作流 "),re=y("创建分支"),ce=y("删除分支"),de={class:"cont"},me={class:"nav"},ie={key:0,class:"bugfix"},se=te((()=>v("dt",null,"bug分支",-1))),pe=y("进入"),Ve={key:1,class:"feature"},he=te((()=>v("dt",null,"feature分支",-1))),ve=y("进入"),fe={key:2,class:"others"},be=te((()=>v("dt",null,"其他分支",-1))),ye=y("进入"),xe={class:"main"},ge=te((()=>v("span",{class:"iconfont icon-layout"},null,-1))),ke={class:"cmd"},je={class:"section"},Ce=te((()=>v("h4",null,"工作流",-1))),Ee={class:"section"},we=te((()=>v("h4",null,"实用工具",-1)));var Ue=M(ne,[["render",function(e,a,l,n,t,u){const o=p("v3-button"),r=p("MapCommand"),c=p("Command"),d=p("v3-collapse-item"),m=p("v3-collapse"),i=p("Xterm");return e.data.ready?(V(),h("div",ue,[v("h1",null,[oe,v("p",null,[w(o,{type:"primary",onClick:e.createBranch},{default:k((()=>[re])),_:1},8,["onClick"]),w(o,{type:"danger",onClick:e.saveStash},{default:k((()=>[ce])),_:1},8,["onClick"])])]),v("div",de,[v("div",me,[e.branchList.bugfix.length?(V(),h("dl",ie,[se,(V(!0),h(f,null,b(e.branchList.bugfix,(a=>(V(),h("dd",{class:z({active:a===e.data.current}),key:a},[y(x(a)+" ",1),a!==e.data.current?(V(),g(o,{key:0,type:"primary",size:"mini",onClick:l=>e.checkout(a),plain:""},{default:k((()=>[pe])),_:2},1032,["onClick"])):P("",!0)],2)))),128))])):P("",!0),e.branchList.feature.length?(V(),h("dl",Ve,[he,(V(!0),h(f,null,b(e.branchList.feature,(a=>(V(),h("dd",{class:z({active:a===e.data.current}),key:a},[y(x(a)+" ",1),a!==e.data.current?(V(),g(o,{key:0,type:"primary",size:"mini",onClick:l=>e.checkout(a),plain:""},{default:k((()=>[ve])),_:2},1032,["onClick"])):P("",!0)],2)))),128))])):P("",!0),e.branchList.others.length?(V(),h("dl",fe,[be,(V(!0),h(f,null,b(e.branchList.others,(a=>(V(),h("dd",{class:z({active:a===e.data.current}),key:a},[y(x(a)+" ",1),a!==e.data.current?(V(),g(o,{key:0,type:"primary",size:"mini",onClick:l=>e.checkout(a),plain:""},{default:k((()=>[ye])),_:2},1032,["onClick"])):P("",!0)],2)))),128))])):P("",!0)]),v("div",xe,[v("h3",null,[v("span",null,[ge,y(" 当前分支："+x(e.data.current),1)]),v("p",null,x(e.data.project.path),1)]),v("div",ke,[v("div",je,[Ce,w(m,{modelValue:e.data.activeNames,"onUpdate:modelValue":a[6]||(a[6]=a=>e.data.activeNames=a),accordion:!0,onChange:e.handleChange},{default:k((()=>[w(d,{name:"1"},{title:k((()=>[w(r,{value:e.commandValue.combine,current:e.data.current,onExec:e.exec},null,8,["value","current","onExec"])])),default:k((()=>[w(c,{modelValue:e.commandValue.combine,"onUpdate:modelValue":a[0]||(a[0]=a=>e.commandValue.combine=a)},null,8,["modelValue"])])),_:1}),w(d,{name:"2"},{title:k((()=>[w(r,{value:e.commandValue.update,current:e.data.current,onExec:e.exec},null,8,["value","current","onExec"])])),default:k((()=>[w(c,{modelValue:e.commandValue.update,"onUpdate:modelValue":a[1]||(a[1]=a=>e.commandValue.update=a)},null,8,["modelValue"])])),_:1}),w(d,{name:"3"},{title:k((()=>[w(r,{value:e.commandValue.build,current:e.data.current,onExec:e.exec},null,8,["value","current","onExec"])])),default:k((()=>[w(c,{modelValue:e.commandValue.build,"onUpdate:modelValue":a[2]||(a[2]=a=>e.commandValue.build=a)},null,8,["modelValue"])])),_:1}),w(d,{name:"4"},{title:k((()=>[w(r,{value:e.commandValue.continue,current:e.data.current,onExec:e.exec},null,8,["value","current","onExec"])])),default:k((()=>[w(c,{modelValue:e.commandValue.continue,"onUpdate:modelValue":a[3]||(a[3]=a=>e.commandValue.continue=a)},null,8,["modelValue"])])),_:1}),w(d,{name:"5"},{title:k((()=>[w(r,{value:e.commandValue.end,current:e.data.current,onExec:e.exec},null,8,["value","current","onExec"])])),default:k((()=>[w(c,{modelValue:e.commandValue.end,"onUpdate:modelValue":a[4]||(a[4]=a=>e.commandValue.end=a)},null,8,["modelValue"])])),_:1}),w(d,{name:"6"},{title:k((()=>[w(r,{value:e.commandValue.branch,current:e.data.current,onExec:e.exec},null,8,["value","current","onExec"])])),default:k((()=>[w(c,{modelValue:e.commandValue.branch,"onUpdate:modelValue":a[5]||(a[5]=a=>e.commandValue.branch=a)},null,8,["modelValue"])])),_:1})])),_:1},8,["modelValue","onChange"])]),v("div",Ee,[we,w(m,{modelValue:e.data.activeNames,"onUpdate:modelValue":a[13]||(a[13]=a=>e.data.activeNames=a),accordion:!0,onChange:e.handleChange},{default:k((()=>[w(d,{name:"11"},{title:k((()=>[w(r,{value:e.commandValue.save,current:e.data.current,onExec:e.exec},null,8,["value","current","onExec"])])),default:k((()=>[w(c,{modelValue:e.commandValue.save,"onUpdate:modelValue":a[7]||(a[7]=a=>e.commandValue.save=a)},null,8,["modelValue"])])),_:1}),w(d,{name:"12"},{title:k((()=>[w(r,{value:e.commandValue.get,current:e.data.current,onExec:e.exec},null,8,["value","current","onExec"])])),default:k((()=>[w(c,{modelValue:e.commandValue.get,"onUpdate:modelValue":a[8]||(a[8]=a=>e.commandValue.get=a)},null,8,["modelValue"])])),_:1}),w(d,{name:"13"},{title:k((()=>[w(r,{value:e.commandValue.copy,current:e.data.current,onExec:e.exec},null,8,["value","current","onExec"])])),default:k((()=>[w(c,{modelValue:e.commandValue.copy,"onUpdate:modelValue":a[9]||(a[9]=a=>e.commandValue.copy=a)},null,8,["modelValue"])])),_:1}),w(d,{name:"14"},{title:k((()=>[w(r,{value:e.commandValue.revert,current:e.data.current,onExec:e.exec},null,8,["value","current","onExec"])])),default:k((()=>[w(c,{modelValue:e.commandValue.revert,"onUpdate:modelValue":a[10]||(a[10]=a=>e.commandValue.revert=a)},null,8,["modelValue"])])),_:1}),w(d,{name:"15"},{title:k((()=>[w(r,{value:e.commandValue.link,current:e.data.current,onExec:e.exec},null,8,["value","current","onExec"])])),default:k((()=>[w(c,{modelValue:e.commandValue.link,"onUpdate:modelValue":a[11]||(a[11]=a=>e.commandValue.link=a)},null,8,["modelValue"])])),_:1}),w(d,{name:"16"},{title:k((()=>[w(r,{value:e.commandValue.unlink,current:e.data.current,onExec:e.exec},null,8,["value","current","onExec"])])),default:k((()=>[w(c,{modelValue:e.commandValue.unlink,"onUpdate:modelValue":a[12]||(a[12]=a=>e.commandValue.unlink=a)},null,8,["modelValue"])])),_:1})])),_:1},8,["modelValue","onChange"])])]),e.data.project?(V(),g(i,{ref:"xterm",class:"xterm",key:"gitmars-xterm",id:e.terminalID,path:e.data.project.path},null,8,["id","path"])):P("",!0)])])])):P("",!0)}],["__scopeId","data-v-22b59854"]]);export{Ue as default};
