import{N as a,ah as t,ai as s,r as e,c as r,K as n,aq as i,j as c,q as o,p as l,e as d,m as p,F as m,ak as u,s as f,y as k,k as j,x as y,B as h,C as v,o as x,v as g}from"./vendor.89db70a2.js";import{X as w}from"./index.90f9ce48.js";import{_ as b,T as C,S as I}from"./index.323fdfce.js";import{u as _}from"./use-current-instance.f8863fef.js";const $={name:"ControlTasks",components:{Xterm:w},async setup(){const{getTerminal:c}=a(C,{}),{socket:o}=a(I,{}),{globalProperties:{$axios:l}}=_(),d=t(),p=s(),m=window.innerWidth,u=window.innerHeight,f=e({project:{id:"",name:"",path:""},scripts:[],terminal:{name:""},ready:!1}),k=r((()=>"tasks-"+f.project.id));n((()=>{})),i((()=>{}));const j=a=>{f.terminal&&o.emit(f.terminal.name+"-input",` ${a}\r`)};return f.project=await(async()=>(await l({url:"/common/project/list",data:{id:p.query.id}})).data)(),f.scripts=await(async()=>{const{data:{scripts:a}}=await l({url:"/cmd/fs/read",data:{path:`${f.project.path}/package.json`}});return a})(),await l({url:"/cmd/cd",data:{dir:f.project.path}}),f.terminal=c&&c(k.value,f.project.path,parseInt(String((m-60-300-32)/7.05)),parseInt(String((u-64-32-34)/17.6))),f.ready=!0,{data:f,terminalID:k,back:()=>{d.push("/project/list")},exec:j,run:a=>{j(`yarn run ${a}`)},route:p}}},q=a=>(h("data-v-46505152"),a=a(),v(),a),S={key:0,class:"page"},T=y(" tasks "),X=y("返回"),D={class:"cont"},z={class:"nav"},B={key:0,class:"bugfix"},F=q((()=>l("dt",null,"脚本指令",-1))),H=y("执行"),K={class:"main"},N=q((()=>l("span",null,[l("span",{class:"iconfont icon-layout"}),y(" 当前分支： ")],-1)));var O=b($,[["render",function(a,t,s,e,r,n){const i=c("v3-button"),h=c("Xterm");return e.data.ready?(x(),o("div",S,[l("h1",null,[T,l("p",null,[d(i,{type:"default",onClick:e.back},{default:p((()=>[X])),_:1},8,["onClick"])])]),l("div",D,[l("div",z,[Object.keys(e.data.scripts).length>0?(x(),o("dl",B,[F,(x(!0),o(m,null,u(e.data.scripts,((a,t)=>(x(),o("dd",{class:g({active:!1}),key:t},[y(k(t)+" ",1),d(i,{type:"primary",size:"mini",onClick:a=>e.run(t),plain:""},{default:p((()=>[H])),_:2},1032,["onClick"])])))),128))])):f("",!0)]),l("div",K,[l("h3",null,[N,l("p",null,k(e.data.project.path),1)]),e.data.project?(x(),j(h,{ref:"xterm",class:"xterm",key:"tasks-xterm",id:e.terminalID,path:e.data.project.path},null,8,["id","path"])):f("",!0)])])])):f("",!0)}],["__scopeId","data-v-46505152"]]);export{O as default};
