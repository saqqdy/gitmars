import{M as a,ae as t,af as s,r as e,c as r,I as n,an as i,j as c,o,p as d,m as l,F as p,ah as m,q as u,x as f,k as j,z as y,A as h,v as k,t as v,e as w,w as x}from"./vendor.80552b3f.js";import{X as g}from"./index.a964cc61.js";import{_ as I,T as b,S as $}from"./index.f0138615.js";import{u as _}from"./use-current-instance.78f6f767.js";const C={name:"ControlTasks",components:{Xterm:g},async setup(){const{getTerminal:c}=a(b,{}),{socket:o}=a($,{}),{globalProperties:{$axios:d}}=_();t();const l=s(),p=window.innerWidth,m=window.innerHeight,u=e({project:{id:"",name:"",path:""},scripts:[],terminal:{name:""},ready:!1}),f=r((()=>"tasks-"+u.project.id));n((()=>{})),i((()=>{}));const j=a=>{u.terminal&&o.emit(u.terminal.name+"-input",` ${a}\r`)};return u.project=await(async()=>(await d({url:"/common/project/list",data:{id:l.query.id}})).data)(),u.scripts=await(async()=>{const{data:{scripts:a}}=await d({url:"/cmd/fs/read",data:{path:`${u.project.path}/package.json`}});return a})(),await d({url:"/cmd/cd",data:{dir:u.project.path}}),u.terminal=c&&c(f.value,u.project.path,parseInt(String((p-60-300-32)/7.05)),parseInt(String((m-64-32-34)/17.6))),u.ready=!0,{data:u,terminalID:f,exec:j,run:a=>{j(`yarn run ${a}`)},route:l}}},S=a=>(y("data-v-7c59e1fe"),a=a(),h(),a),T={key:0,class:"page"},X=S((()=>l("h1",null,"tasks",-1))),q={class:"cont"},z={class:"nav"},D={key:0,class:"bugfix"},A=S((()=>l("dt",null,"脚本指令",-1))),F=k("执行"),H={class:"main"},M=S((()=>l("span",null,[l("span",{class:"iconfont icon-layout"}),k(" 当前分支： ")],-1)));var O=I(C,[["render",function(a,t,s,e,r,n){const i=c("v3-button"),y=c("Xterm");return e.data.ready?(o(),d("div",T,[X,l("div",q,[l("div",z,[Object.keys(e.data.scripts).length>0?(o(),d("dl",D,[A,(o(!0),d(p,null,m(e.data.scripts,((a,t)=>(o(),d("dd",{class:v({active:!1}),key:t},[k(f(t)+" ",1),w(i,{type:"primary",size:"mini",onClick:a=>e.run(t),plain:""},{default:x((()=>[F])),_:2},1032,["onClick"])])))),128))])):u("",!0)]),l("div",H,[l("h3",null,[M,l("p",null,f(e.data.project.path),1)]),e.data.project?(o(),j(y,{ref:"xterm",class:"xterm",key:"tasks-xterm",id:e.terminalID,path:e.data.project.path},null,8,["id","path"])):u("",!0)])])])):u("",!0)}],["__scopeId","data-v-7c59e1fe"]]);export{O as default};
