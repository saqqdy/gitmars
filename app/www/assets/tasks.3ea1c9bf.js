import{H as a,aa as t,ab as s,r as e,d as r,B as n,aj as i,g as c,o as d,j as o,i as l,F as p,ad as m,k as u,t as j,h as f,v as y,x as h,q as k,p as v,e as g,w}from"./vendor.e07efed3.js";import{X as x}from"./index.5d1ac761.js";import{_ as b,T as I,S as $}from"./index.b19ee5f8.js";import{u as _}from"./use-current-instance.c580ffd2.js";const C={name:"ControlTasks",components:{Xterm:x},async setup(){const{getTerminal:c}=a(I,{}),{socket:d}=a($,{}),{globalProperties:{$axios:o}}=_();t();const l=s(),p=window.innerWidth,m=window.innerHeight,u=e({project:{id:"",name:"",path:""},scripts:[],terminal:{name:""},ready:!1}),j=r((()=>"tasks-"+u.project.id));n((()=>{})),i((()=>{}));const f=a=>{u.terminal&&d.emit(u.terminal.name+"-input",` ${a}\r`)};return u.project=await(async()=>(await o({url:"/common/project/list",data:{id:l.query.id}})).data)(),u.scripts=await(async()=>{const{data:{scripts:a}}=await o({url:"/cmd/fs/read",data:{path:`${u.project.path}/package.json`}});return a})(),await o({url:"/cmd/cd",data:{dir:u.project.path}}),u.terminal=c&&c(j.value,u.project.path,parseInt(String((p-60-300-32)/7.05)),parseInt(String((m-64-32-34)/17.6))),u.ready=!0,{data:u,terminalID:j,exec:f,run:a=>{f(`yarn run ${a}`)},route:l}}},S=a=>(y("data-v-7c59e1fe"),a=a(),h(),a),T={key:0,class:"page"},X=S((()=>l("h1",null,"tasks",-1))),q={class:"cont"},D={class:"nav"},H={key:0,class:"bugfix"},z=S((()=>l("dt",null,"脚本指令",-1))),B=k("执行"),F={class:"main"},O=S((()=>l("span",null,[l("span",{class:"iconfont icon-layout"}),k(" 当前分支： ")],-1)));var P=b(C,[["render",function(a,t,s,e,r,n){const i=c("v3-button"),y=c("Xterm");return e.data.ready?(d(),o("div",T,[X,l("div",q,[l("div",D,[Object.keys(e.data.scripts).length>0?(d(),o("dl",H,[z,(d(!0),o(p,null,m(e.data.scripts,((a,t)=>(d(),o("dd",{class:v({active:!1}),key:t},[k(j(t)+" ",1),g(i,{type:"primary",size:"mini",onClick:a=>e.run(t),plain:""},{default:w((()=>[B])),_:2},1032,["onClick"])])))),128))])):u("",!0)]),l("div",F,[l("h3",null,[O,l("p",null,j(e.data.project.path),1)]),e.data.project?(d(),f(y,{ref:"xterm",class:"xterm",key:"tasks-xterm",id:e.terminalID,path:e.data.project.path},null,8,["id","path"])):u("",!0)])])])):u("",!0)}],["__scopeId","data-v-7c59e1fe"]]);export{P as default};
