import{M as a,af as t,ag as s,r as e,c as r,I as n,ao as i,j as c,o,p as d,m as l,F as p,ai as m,q as u,x as j,k as y,z as f,A as h,v as k,t as v,e as b,w as g}from"./vendor.ba8c2ee1.js";import{X as w}from"./index.beb19822.js";import{_ as x,T as I,S as $}from"./index.b46b4428.js";import{u as _}from"./use-current-instance.baaddaff.js";const C={name:"ControlTasks",components:{Xterm:w},async setup(){const{getTerminal:c}=a(I,{}),{socket:o}=a($,{}),{globalProperties:{$axios:d}}=_();t();const l=s(),p=window.innerWidth,m=window.innerHeight,u=e({project:{id:"",name:"",path:""},scripts:[],terminal:{name:""},ready:!1}),j=r((()=>"tasks-"+u.project.id));n((()=>{})),i((()=>{}));const y=a=>{u.terminal&&o.emit(u.terminal.name+"-input",` ${a}\r`)};return u.project=await(async()=>(await d({url:"/common/project/list",data:{id:l.query.id}})).data)(),u.scripts=await(async()=>{const{data:{scripts:a}}=await d({url:"/cmd/fs/read",data:{path:`${u.project.path}/package.json`}});return a})(),await d({url:"/cmd/cd",data:{dir:u.project.path}}),u.terminal=c&&c(j.value,u.project.path,parseInt(String((p-60-300-32)/7.05)),parseInt(String((m-64-32-34)/17.6))),u.ready=!0,{data:u,terminalID:j,exec:y,run:a=>{y(`yarn run ${a}`)},route:l}}},S=a=>(f("data-v-5b2a56a3"),a=a(),h(),a),T={key:0,class:"page"},X=S((()=>l("h1",null,"tasks",-1))),q={class:"cont"},z={class:"nav"},D={key:0,class:"bugfix"},A=S((()=>l("dt",null,"脚本指令",-1))),F=k("执行"),H={class:"main"},M=S((()=>l("span",null,[l("span",{class:"iconfont icon-layout"}),k(" 当前分支： ")],-1)));var O=x(C,[["render",function(a,t,s,e,r,n){const i=c("v3-button"),f=c("Xterm");return e.data.ready?(o(),d("div",T,[X,l("div",q,[l("div",z,[Object.keys(e.data.scripts).length>0?(o(),d("dl",D,[A,(o(!0),d(p,null,m(e.data.scripts,((a,t)=>(o(),d("dd",{class:v({active:!1}),key:t},[k(j(t)+" ",1),b(i,{type:"primary",size:"mini",onClick:a=>e.run(t),plain:""},{default:g((()=>[F])),_:2},1032,["onClick"])])))),128))])):u("",!0)]),l("div",H,[l("h3",null,[M,l("p",null,j(e.data.project.path),1)]),e.data.project?(o(),y(f,{ref:"xterm",class:"xterm",key:"tasks-xterm",id:e.terminalID,path:e.data.project.path},null,8,["id","path"])):u("",!0)])])])):u("",!0)}],["__scopeId","data-v-5b2a56a3"]]);export{O as default};
