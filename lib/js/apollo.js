"use strict";const e=require("path"),t=require("node-apollo"),o=require("shelljs"),{error:i,writeFile:n}=require("./index"),r=require("./getConfig");module.exports=function(){return l=this,u=null,s=function*(){const l=e.join(__dirname,"../../cache"),u=(new Date).getTime();let s;if(o.test("-f",l+"/buildConfig.json")&&u-parseInt(o.cat(l+"/buildConfig.txt").stdout)<864e5)return require(l+"/buildConfig.json");const a=r();if(!a.apolloConfig)return o.echo(i("请配置apollo")),void o.exit(0);if("string"==typeof a.apolloConfig)try{s=JSON.parse(a.apolloConfig)}catch(e){return}else s=a.apolloConfig;const c=yield t.remoteConfigService(s);return yield n(l+"/buildConfig.txt",String(u)),yield n(l+"/buildConfig.json",JSON.stringify(c.content)),c.content},new Promise(((e,t)=>{var o=e=>{try{n(s.next(e))}catch(e){t(e)}},i=e=>{try{n(s.throw(e))}catch(e){t(e)}},n=t=>t.done?e(t.value):Promise.resolve(t.value).then(o,i);n((s=s.apply(l,u)).next())}));var l,u,s};
