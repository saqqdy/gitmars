"use strict";const e=require("path"),i=require("node-apollo"),o=require("shelljs"),{error:t,writeFile:n}=require("./index"),r=require("./getConfig");module.exports=async function(){const l=e.join(__dirname,"../../cache"),a=(new Date).getTime();let s;if(o.test("-f",l+"/buildConfig.json")){if(a-parseInt(o.cat(l+"/buildConfig.txt").stdout)<864e5)return require(l+"/buildConfig.json")}const f=r();if(!f.apolloConfig)return o.echo(t("请配置apollo")),void o.exit(0);if("string"==typeof f.apolloConfig)try{s=JSON.parse(f.apolloConfig)}catch(e){return}else s=f.apolloConfig;const u=await i.remoteConfigService(s);return await n(l+"/buildConfig.txt",String(a)),await n(l+"/buildConfig.json",JSON.stringify(u.content)),u.content};
