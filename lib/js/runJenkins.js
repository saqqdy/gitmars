"use strict";var e=(e,t,r)=>new Promise(((n,i)=>{var o=e=>{try{a(r.next(e))}catch(e){i(e)}},s=e=>{try{a(r.throw(e))}catch(e){i(e)}},a=e=>e.done?n(e.value):Promise.resolve(e.value).then(o,s);a((r=r.apply(e,t)).next())}));const t=require("shelljs"),r=require("./apollo"),{error:n,success:i,mapTemplate:o}=require("./index");module.exports=function(s){return e(this,arguments,(function*({env:e,project:s,app:a="all"}){const p=yield r(),l=p[e];let c;if(!l)return t.echo(n("请输入正确的环境名称")),void t.exit(1);if(c=l.list.find((e=>e.name===s)),!c)return t.echo(n("请输入正确的项目名称")),void t.exit(1);if(a&&c.apps&&!c.apps.includes(a))return t.echo(n("请输入正确的应用名称")),void t.exit(1);if(!p.template)return t.echo(n("请配置Jenkins构建地址模板")),void t.exit(1);const u=o(c.apps&&c.apps.length>0?p.templateWithParam:p.template,{line:l.line,project:c.project,token:l.token,app:a});t.exec(`curl -u ${p.username}:${p.password} "${u}"`,{silent:!0}),t.echo(i("成功调起Jenkins构建"))}))};
