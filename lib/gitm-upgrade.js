#!/usr/bin/env node
"use strict";const{program:s}=require("commander"),{spawnSync:e}=require("child_process"),r=require("shelljs"),{options:t,args:o}=require("./conf/upgrade"),{success:i}=require("./js/index"),{createArgs:a}=require("./js/tools"),n=require("ora");s.name("gitm upgrade").usage("[version]").description("升级gitmars"),o.length>0&&s.arguments(a(o)),t.forEach((e=>{s.option(e.flags,e.description,e.defaultValue)})),s.action((async(s,t)=>{const o=n(i("正在安装请稍后")).start();if(s){const e=s.match(/[0-9.]+$/);e?s=e[0]:["alpha","lite","beta","release","latest","next"].includes(s)||(console.error("输入的版本号不正确"),r.exit(0))}else s="latest";const a=["npm",["install","-g",`gitmars@${s}`]],c=["npm",["uninstall","-g","gitmars"]];t.mirror&&(a[1]=a[1].concat(["-registry","https://registry.npm.taobao.org"]));0!==e(c[0],c[1],{stdio:"inherit",shell:"win32"===process.platform}).status&&(console.warn("卸载出错了"),process.exit(0));const l=e(a[0],a[1],{stdio:"inherit",shell:"win32"===process.platform});e("gitm",["-v"],{stdio:"inherit",shell:"win32"===process.platform}),r.echo(`\n${i("安装完成")}`),o.stop(),0===l.status||console.warn("安装出错了"),process.exit(0)})),s.parse(process.argv);
