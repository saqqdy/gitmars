#!/usr/bin/env node
"use strict";const{program:e}=require("commander"),a=require("shelljs"),n=require("inquirer"),{options:m,args:r}=require("./conf/go"),{combine:o,end:t,update:c,build:i,start:d,admin:s,branch:u,copy:l,get:p,save:g,revert:h,link:v,unlink:b,postmsg:q}=require("./js/go/index"),{success:f,getCurrent:x}=require("./js/index"),{createArgs:y}=require("./js/tools");e.name("gitm go").usage("[command]").description("智能猜测你要执行的动作"),r.length>0&&e.arguments(y(r)),m.forEach((a=>{e.option(a.flags,a.description,a.defaultValue)})),e.action((()=>{return e=void 0,m=null,r=function*(){const e=x();a.echo(f(`当前分支${e}，系统猜测你可能想做以下操作：`)),n.prompt({type:"list",name:"command",message:"请选择你想要的操作?",default:"combine",choices:[new n.Separator(" === 1. Gitmars工作流 === "),"combine","end","update","build","start","admin.publish","admin.update","admin.create","admin.clean",new n.Separator(" === 2. 高级工具 === "),"branch","copy","get","save","revert","link","unlink","postmsg",new n.Separator(" === 退出 === "),"exit",new n.Separator],filter:e=>e}).then((e=>{"exit"===e.command&&(a.echo(f("已退出")),a.exit(0)),a.echo(f(`你选择了${e.command}指令`)),"combine"===e.command?o():"end"===e.command?(a.echo("注意end指令会在执行合并代码到dev和预发之后删除分支"),t()):"update"===e.command?c():"build"===e.command?i():"start"===e.command?d():"admin.publish"===e.command?s.publish():"admin.update"===e.command?s.update():"admin.create"===e.command?s.create():"admin.clean"===e.command?s.clean():"branch"===e.command?u():"copy"===e.command?l():"get"===e.command?p():"save"===e.command?g():"revert"===e.command?h():"link"===e.command?v():"unlink"===e.command?b():"postmsg"===e.command&&q()}))},new Promise(((a,n)=>{var o=e=>{try{c(r.next(e))}catch(e){n(e)}},t=e=>{try{c(r.throw(e))}catch(e){n(e)}},c=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,t);c((r=r.apply(e,m)).next())}));var e,m,r})),e.parse(process.argv);
